services:
  mageai:
    image: mageai/mageai:latest  
    container_name: mageai_service
    ports:
      - "6789:6789"
    volumes:
      - ./app:/app  
    command: ["mage", "start", "mageai/poleng", "--host", "0.0.0.0", "--port", "6789"]
    depends_on:
      - mlflow
    environment:
      - PYTHONUNBUFFERED=1
      - PIP_NO_CACHE_DIR=1
    networks:
      - user_network

  mlflow:
    image: python:3.10
    container_name: mlflow_service
    ports:
      - "5000:5000"
    volumes:
      - ./app:/app 
    command: > 
      bash -c
      "pip install -r /app/requirements.txt && 
      mlflow server --backend-store-uri sqlite:///mlflow/mlflow.db 
      --default-artifact-root /app/mlflow/mlruns/poleng 
      --host 0.0.0.0 --port 5000"
    networks:
      - user_network
    environment:
      - MLFLOW_TRACKING_URI=http://0.0.0.0:5000

networks:
  user_network:
    driver: bridge
